<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hospital Management | Postmarket | EvalScale</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600&family=Instrument+Serif:ital@0;1&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <style>
        :root { --color-bg: #f8f9fc; --color-text-primary: #1a1f36; --color-text-secondary: #4a5568; --color-text-muted: #718096; --color-accent-blue: #0066cc; --color-accent-teal: #0d9488; --color-accent-green: #10b981; --color-accent-orange: #f59e0b; --color-accent-red: #ef4444; --color-accent-purple: #7c3aed; --color-glass-bg: rgba(255, 255, 255, 0.7); --color-glass-border: rgba(255, 255, 255, 0.8); --font-display: 'Instrument Serif', Georgia, serif; --font-body: 'DM Sans', sans-serif; }
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: var(--font-body); background: var(--color-bg); color: var(--color-text-primary); line-height: 1.6; }
        .bg-gradient { position: fixed; inset: 0; z-index: -1; background: radial-gradient(ellipse at 20% 20%, #e8f4f8 0%, transparent 50%), radial-gradient(ellipse at 80% 80%, #f0e8f8 0%, transparent 50%), var(--color-bg); }
        
        /* Navigation */
        .navbar { display: flex; align-items: center; justify-content: space-between; padding: 16px 40px; background: var(--color-glass-bg); backdrop-filter: blur(20px); border-bottom: 1px solid var(--color-glass-border); position: sticky; top: 0; z-index: 100; }
        .nav-logo { display: flex; align-items: center; gap: 10px; text-decoration: none; color: var(--color-text-primary); }
        .nav-logo-icon { width: 36px; height: 36px; background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-teal)); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .nav-logo-icon svg { width: 20px; height: 20px; fill: white; }
        .nav-logo-text { font-family: var(--font-display); font-size: 1.5rem; }
        .nav-breadcrumb { display: flex; align-items: center; gap: 8px; color: var(--color-text-muted); font-size: 0.875rem; }
        .nav-breadcrumb a { color: var(--color-text-muted); text-decoration: none; }
        .nav-breadcrumb a:hover { color: var(--color-accent-blue); }
        .nav-breadcrumb span { color: var(--color-text-primary); font-weight: 500; }
        .nav-breadcrumb svg { width: 16px; height: 16px; fill: currentColor; }
        .nav-user { display: flex; align-items: center; gap: 8px; }
        .nav-user-avatar { width: 36px; height: 36px; background: linear-gradient(135deg, var(--color-accent-teal), #10b981); border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600; font-size: 0.875rem; }
        
        /* Theme & Notifications */
        .theme-toggle, .notification-bell { width: 36px; height: 36px; background: transparent; border: none; border-radius: 50%; display: flex; align-items: center; justify-content: center; cursor: pointer; position: relative; }
        .theme-toggle:hover, .notification-bell:hover { background: rgba(0,0,0,0.05); }
        .theme-toggle svg, .notification-bell svg { width: 20px; height: 20px; fill: var(--color-text-muted); }
        .theme-toggle .moon-icon { display: none; }
        body.dark-mode .theme-toggle .sun-icon { display: none; }
        body.dark-mode .theme-toggle .moon-icon { display: block; }
        .notification-badge { position: absolute; top: 4px; right: 4px; width: 16px; height: 16px; background: var(--color-accent-red); color: white; font-size: 0.625rem; font-weight: 600; border-radius: 50%; display: flex; align-items: center; justify-content: center; animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.1); } }
        .nav-notifications { position: relative; }
        .notification-dropdown { position: absolute; top: 100%; right: 0; width: 360px; background: white; border-radius: 16px; box-shadow: 0 10px 40px rgba(0,0,0,0.15); opacity: 0; visibility: hidden; transform: translateY(10px); transition: all 0.3s; z-index: 1000; margin-top: 8px; overflow: hidden; }
        .notification-dropdown.active { opacity: 1; visibility: visible; transform: translateY(0); }
        .notification-header { padding: 16px 20px; border-bottom: 1px solid rgba(0,0,0,0.06); display: flex; justify-content: space-between; }
        .notification-title { font-weight: 600; }
        .notification-clear { font-size: 0.75rem; color: var(--color-accent-blue); cursor: pointer; }
        .notification-list { max-height: 280px; overflow-y: auto; }
        .notification-item { padding: 14px 20px; border-bottom: 1px solid rgba(0,0,0,0.04); display: flex; gap: 12px; }
        .notification-item.unread { background: rgba(0, 102, 204, 0.04); }
        .notification-icon { width: 36px; height: 36px; border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .notification-icon.alert { background: rgba(239, 68, 68, 0.15); }
        .notification-icon.alert svg { fill: var(--color-accent-red); }
        .notification-icon.warning { background: rgba(245, 158, 11, 0.15); }
        .notification-icon.warning svg { fill: var(--color-accent-orange); }
        .notification-icon.success { background: rgba(16, 185, 129, 0.15); }
        .notification-icon.success svg { fill: var(--color-accent-green); }
        .notification-icon svg { width: 18px; height: 18px; }
        .notification-content { flex: 1; }
        .notification-text { font-size: 0.8125rem; margin-bottom: 2px; }
        .notification-text strong { font-weight: 600; }
        .notification-time { font-size: 0.6875rem; color: var(--color-text-muted); }
        .notification-footer { padding: 12px 20px; text-align: center; border-top: 1px solid rgba(0,0,0,0.06); }
        .notification-footer a { font-size: 0.8125rem; color: var(--color-accent-blue); text-decoration: none; }
        
        /* Main */
        .main { padding: 40px; max-width: 1400px; margin: 0 auto; }
        .page-header { margin-bottom: 32px; animation: fadeInUp 0.6s ease-out; }
        .page-title { font-family: var(--font-display); font-size: 2rem; margin-bottom: 4px; }
        .page-subtitle { color: var(--color-text-secondary); }
        
        /* Alert Banner */
        .alert-banner { display: flex; align-items: center; gap: 16px; padding: 16px 20px; background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(245, 158, 11, 0.1)); border: 1px solid rgba(239, 68, 68, 0.2); border-radius: 12px; margin-bottom: 24px; animation: fadeInUp 0.6s ease-out 0.1s backwards; }
        .alert-banner.safe { background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(13, 148, 136, 0.1)); border-color: rgba(16, 185, 129, 0.2); }
        .alert-icon { width: 44px; height: 44px; background: var(--color-accent-red); border-radius: 12px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
        .alert-banner.safe .alert-icon { background: var(--color-accent-green); }
        .alert-icon svg { width: 24px; height: 24px; fill: white; }
        .alert-content { flex: 1; }
        .alert-title { font-weight: 600; font-size: 0.9375rem; margin-bottom: 2px; }
        .alert-desc { font-size: 0.8125rem; color: var(--color-text-secondary); }
        .alert-action { padding: 10px 20px; background: var(--color-accent-red); color: white; border: none; border-radius: 8px; font-weight: 500; cursor: pointer; transition: all 0.2s; }
        .alert-action:hover { transform: translateY(-1px); }
        .alert-banner.safe .alert-action { background: var(--color-accent-green); }
        
        /* Tabs */
        .tabs-container { margin-bottom: 32px; }
        .tabs { display: flex; gap: 4px; background: var(--color-glass-bg); border: 1px solid var(--color-glass-border); border-radius: 16px; padding: 6px; overflow-x: auto; }
        .tab { padding: 12px 20px; border: none; background: transparent; border-radius: 12px; font-family: var(--font-body); font-size: 0.875rem; font-weight: 500; color: var(--color-text-muted); cursor: pointer; white-space: nowrap; transition: all 0.3s; }
        .tab:hover { color: var(--color-text-primary); }
        .tab.active { background: white; color: var(--color-text-primary); box-shadow: 0 2px 8px rgba(0,0,0,0.08); }
        .tab-content { display: none; animation: fadeIn 0.4s ease-out; }
        .tab-content.active { display: block; }
        
        /* Cards */
        .content-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px; }
        .card { background: var(--color-glass-bg); backdrop-filter: blur(20px); border: 1px solid var(--color-glass-border); border-radius: 20px; padding: 24px; box-shadow: 0 4px 24px rgba(0,50,100,0.08); animation: fadeInUp 0.6s ease-out backwards; }
        .card.full-width { grid-column: 1 / -1; }
        .card-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
        .card-title { font-family: var(--font-display); font-size: 1.125rem; }
        .card-subtitle { font-size: 0.8125rem; color: var(--color-text-muted); margin-top: 2px; }
        .card-badge { padding: 4px 10px; background: rgba(16, 185, 129, 0.15); color: var(--color-accent-green); border-radius: 6px; font-size: 0.75rem; font-weight: 600; }
        .card-badge.warning { background: rgba(245, 158, 11, 0.15); color: var(--color-accent-orange); }
        .card-badge.danger { background: rgba(239, 68, 68, 0.15); color: var(--color-accent-red); }
        .card-badge.live { position: relative; padding-left: 18px; }
        .card-badge.live::before { content: ''; position: absolute; left: 8px; top: 50%; transform: translateY(-50%); width: 6px; height: 6px; background: currentColor; border-radius: 50%; animation: pulse 2s infinite; }
        
        /* Buttons */
        .btn { padding: 12px 24px; border-radius: 12px; font-family: var(--font-body); font-size: 0.9375rem; font-weight: 500; cursor: pointer; transition: all 0.3s; display: inline-flex; align-items: center; gap: 8px; border: none; }
        .btn-primary { background: linear-gradient(135deg, var(--color-accent-teal), var(--color-accent-green)); color: white; }
        .btn-primary:hover { transform: translateY(-2px); }
        .btn-secondary { background: var(--color-glass-bg); color: var(--color-text-primary); border: 1px solid var(--color-glass-border); }
        .btn-danger { background: linear-gradient(135deg, var(--color-accent-red), #f87171); color: white; }
        .btn svg { width: 18px; height: 18px; fill: currentColor; }
        
        /* Chart */
        .chart-container { position: relative; height: 280px; }
        .chart-container.large { height: 350px; }
        
        /* Stats Row */
        .stats-row { display: grid; grid-template-columns: repeat(4, 1fr); gap: 16px; margin-bottom: 24px; }
        .stat-card { background: var(--color-glass-bg); border: 1px solid var(--color-glass-border); border-radius: 16px; padding: 20px; text-align: center; animation: fadeInUp 0.6s ease-out backwards; }
        .stat-card:nth-child(1) { animation-delay: 0.1s; }
        .stat-card:nth-child(2) { animation-delay: 0.15s; }
        .stat-card:nth-child(3) { animation-delay: 0.2s; }
        .stat-card:nth-child(4) { animation-delay: 0.25s; }
        .stat-value { font-size: 1.75rem; font-weight: 600; line-height: 1; margin-bottom: 4px; }
        .stat-value.good { color: var(--color-accent-green); }
        .stat-value.warning { color: var(--color-accent-orange); }
        .stat-value.danger { color: var(--color-accent-red); }
        .stat-label { font-size: 0.75rem; color: var(--color-text-muted); text-transform: uppercase; letter-spacing: 0.05em; }
        
        /* Safety Floor Indicator */
        .safety-indicator { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(0,0,0,0.02); border-radius: 10px; margin-top: 16px; }
        .safety-dot { width: 12px; height: 12px; border-radius: 50%; }
        .safety-dot.safe { background: var(--color-accent-green); box-shadow: 0 0 8px var(--color-accent-green); }
        .safety-dot.warning { background: var(--color-accent-orange); box-shadow: 0 0 8px var(--color-accent-orange); }
        .safety-dot.danger { background: var(--color-accent-red); box-shadow: 0 0 8px var(--color-accent-red); animation: blink 1s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .safety-text { flex: 1; font-size: 0.8125rem; }
        .safety-value { font-weight: 600; }
        
        /* Hardware Map */
        .hardware-map { display: grid; grid-template-columns: repeat(4, 1fr); gap: 12px; }
        .hardware-node { padding: 16px; background: rgba(0,0,0,0.02); border-radius: 12px; text-align: center; cursor: grab; transition: all 0.2s; border: 2px solid transparent; }
        .hardware-node:hover { background: rgba(0,0,0,0.04); }
        .hardware-node.active { border-color: var(--color-accent-teal); background: rgba(13, 148, 136, 0.08); }
        .hardware-node.dragging { opacity: 0.5; transform: scale(0.95); }
        .node-icon { width: 40px; height: 40px; margin: 0 auto 8px; background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-teal)); border-radius: 10px; display: flex; align-items: center; justify-content: center; }
        .node-icon svg { width: 20px; height: 20px; fill: white; }
        .node-name { font-weight: 600; font-size: 0.8125rem; margin-bottom: 4px; }
        .node-dept { font-size: 0.6875rem; color: var(--color-text-muted); }
        .node-util { font-size: 0.75rem; margin-top: 8px; }
        .node-util-bar { height: 4px; background: rgba(0,0,0,0.1); border-radius: 2px; margin-top: 4px; overflow: hidden; }
        .node-util-fill { height: 100%; border-radius: 2px; transition: width 0.5s; }
        
        /* XAI Gallery */
        .xai-gallery { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .xai-case { aspect-ratio: 1; background: linear-gradient(135deg, #1a1f36, #2d3748); border-radius: 12px; position: relative; overflow: hidden; cursor: pointer; }
        .xai-scan { position: absolute; inset: 10%; border-radius: 40% 40% 35% 35%; background: radial-gradient(ellipse at 50% 30%, rgba(255,255,255,0.08) 0%, rgba(255,255,255,0.03) 40%, transparent 70%); }
        .xai-heatmap { position: absolute; inset: 0; background: radial-gradient(circle at var(--x, 60%) var(--y, 40%), rgba(239, 68, 68, 0.7) 0%, rgba(245, 158, 11, 0.4) 20%, transparent 50%); opacity: 0; transition: opacity 0.3s; }
        .xai-case.show-heatmap .xai-heatmap { opacity: 1; }
        .xai-label { position: absolute; bottom: 8px; left: 8px; right: 8px; padding: 6px 10px; background: rgba(0,0,0,0.7); border-radius: 6px; font-size: 0.6875rem; color: white; display: flex; justify-content: space-between; }
        .xai-confidence { color: var(--color-accent-orange); }
        
        /* Toggle */
        .toggle-row { display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(0,0,0,0.02); border-radius: 10px; margin-bottom: 16px; }
        .toggle-label { flex: 1; font-size: 0.875rem; }
        .toggle { width: 48px; height: 26px; background: rgba(0,0,0,0.15); border-radius: 13px; cursor: pointer; position: relative; transition: background 0.3s; }
        .toggle.active { background: var(--color-accent-green); }
        .toggle::after { content: ''; position: absolute; top: 3px; left: 3px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .toggle.active::after { transform: translateX(22px); }
        
        /* Shadow Comparison */
        .shadow-models { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 16px; }
        .shadow-model { padding: 16px; border-radius: 12px; border: 2px solid; }
        .shadow-model.live { border-color: var(--color-accent-green); background: rgba(16, 185, 129, 0.05); }
        .shadow-model.candidate { border-color: var(--color-accent-purple); border-style: dashed; background: rgba(124, 58, 237, 0.05); }
        .shadow-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; }
        .shadow-name { font-weight: 600; }
        .shadow-tag { padding: 2px 8px; border-radius: 4px; font-size: 0.6875rem; font-weight: 600; text-transform: uppercase; }
        .shadow-model.live .shadow-tag { background: rgba(16, 185, 129, 0.15); color: var(--color-accent-green); }
        .shadow-model.candidate .shadow-tag { background: rgba(124, 58, 237, 0.15); color: var(--color-accent-purple); }
        .shadow-stat { display: flex; justify-content: space-between; padding: 6px 0; border-bottom: 1px solid rgba(0,0,0,0.06); font-size: 0.8125rem; }
        .shadow-stat:last-child { border-bottom: none; }
        .shadow-stat-value.better { color: var(--color-accent-green); }
        .shadow-stat-value.worse { color: var(--color-accent-red); }
        
        /* Long Press Button */
        .btn-longpress { position: relative; overflow: hidden; }
        .btn-longpress .progress { position: absolute; inset: 0; background: rgba(255,255,255,0.3); transform: scaleX(0); transform-origin: left; }
        .btn-longpress.pressing .progress { transform: scaleX(1); transition: transform 3s linear; }
        
        /* Audit Trail */
        .audit-trail { max-height: 300px; overflow-y: auto; }
        .audit-item { display: flex; gap: 12px; padding: 12px 0; border-bottom: 1px solid rgba(0,0,0,0.06); }
        .audit-item:last-child { border-bottom: none; }
        .audit-time { font-size: 0.6875rem; color: var(--color-text-muted); min-width: 70px; }
        .audit-content { flex: 1; font-size: 0.8125rem; }
        .audit-user { font-weight: 500; }
        .audit-action { color: var(--color-text-secondary); }
        .audit-badge { display: inline-block; padding: 1px 6px; border-radius: 4px; font-size: 0.625rem; font-weight: 600; margin-left: 8px; }
        .audit-badge.signed { background: rgba(16, 185, 129, 0.15); color: var(--color-accent-green); }
        
        /* Modal */
        .modal-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); backdrop-filter: blur(4px); display: flex; align-items: center; justify-content: center; z-index: 1000; opacity: 0; visibility: hidden; transition: all 0.3s; }
        .modal-overlay.active { opacity: 1; visibility: visible; }
        .modal { background: white; border-radius: 24px; padding: 32px; max-width: 500px; width: 90%; transform: translateY(20px); transition: transform 0.3s; }
        .modal-overlay.active .modal { transform: translateY(0); }
        .modal-header { text-align: center; margin-bottom: 24px; }
        .modal-icon { width: 64px; height: 64px; margin: 0 auto 16px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .modal-icon.danger { background: linear-gradient(135deg, var(--color-accent-red), #f87171); }
        .modal-icon.success { background: linear-gradient(135deg, var(--color-accent-green), #34d399); }
        .modal-icon.purple { background: linear-gradient(135deg, var(--color-accent-purple), #a855f7); }
        .modal-icon svg { width: 32px; height: 32px; fill: white; }
        .modal-title { font-family: var(--font-display); font-size: 1.5rem; }
        .modal-subtitle { color: var(--color-text-muted); margin-top: 8px; }
        .modal-content { margin-bottom: 24px; }
        .modal-warning { padding: 16px; background: rgba(239, 68, 68, 0.1); border-radius: 12px; font-size: 0.875rem; color: var(--color-accent-red); text-align: center; }
        .modal-actions { display: flex; gap: 12px; }
        .modal-actions .btn { flex: 1; justify-content: center; }
        
        /* Signature */
        .signature-section { margin: 20px 0; }
        .signature-input { width: 100%; padding: 14px 16px; border: 2px solid rgba(0,0,0,0.1); border-radius: 12px; font-family: 'Instrument Serif', serif; font-size: 1.25rem; font-style: italic; }
        .signature-input:focus { outline: none; border-color: var(--color-accent-blue); }
        .checkbox-item { display: flex; align-items: center; gap: 12px; padding: 14px 16px; background: var(--color-bg); border-radius: 12px; cursor: pointer; margin-top: 12px; }
        .checkbox-item input { display: none; }
        .checkbox-custom { width: 22px; height: 22px; border: 2px solid rgba(0,0,0,0.2); border-radius: 6px; display: flex; align-items: center; justify-content: center; transition: all 0.2s; flex-shrink: 0; }
        .checkbox-item input:checked + .checkbox-custom { background: var(--color-accent-green); border-color: var(--color-accent-green); }
        .checkbox-item input:checked + .checkbox-custom::after { content: '✓'; color: white; font-size: 14px; font-weight: bold; }
        .checkbox-label { font-size: 0.875rem; color: var(--color-text-secondary); }
        
        /* Success Animation */
        .success-animation { width: 100px; height: 100px; margin: 0 auto 20px; position: relative; }
        .success-circle { width: 80px; height: 80px; background: linear-gradient(135deg, var(--color-accent-green), #34d399); border-radius: 50%; position: absolute; top: 10px; left: 10px; display: flex; align-items: center; justify-content: center; animation: scaleIn 0.5s ease-out; box-shadow: 0 8px 32px rgba(16, 185, 129, 0.4); }
        .success-circle svg { width: 40px; height: 40px; fill: white; }
        @keyframes scaleIn { 0% { transform: scale(0); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        
        /* Animations */
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(24px); } to { opacity: 1; transform: translateY(0); } }
        
        /* Responsive */
        @media (max-width: 1024px) { .content-grid { grid-template-columns: 1fr; } .stats-row { grid-template-columns: repeat(2, 1fr); } .hardware-map { grid-template-columns: repeat(2, 1fr); } }
        @media (max-width: 768px) { .navbar { padding: 12px 20px; } .main { padding: 24px 20px; } .shadow-models { grid-template-columns: 1fr; } }
        
        /* Dark Mode */
        body.dark-mode { --color-bg: #0f1219; --color-text-primary: #f1f5f9; --color-text-secondary: #94a3b8; --color-text-muted: #64748b; --color-glass-bg: rgba(30, 41, 59, 0.8); --color-glass-border: rgba(51, 65, 85, 0.5); }
        body.dark-mode .modal, body.dark-mode .notification-dropdown { background: #1e293b; }
        body.dark-mode .signature-input, body.dark-mode .checkbox-item { background: #0f172a; border-color: rgba(255,255,255,0.1); color: var(--color-text-primary); }
    </style>
</head>
<body>
    <div class="bg-gradient"></div>
    
    <nav class="navbar">
        <a href="index.html" class="nav-logo">
            <div class="nav-logo-icon"><svg viewBox="0 0 24 24"><path d="M19 3H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-1 11h-4v4h-4v-4H6v-4h4V6h4v4h4v4z"/></svg></div>
            <span class="nav-logo-text">EvalScale</span>
        </a>
        <div class="nav-breadcrumb">
            <a href="index.html">Home</a>
            <svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg>
            <span>Hospital Management (Postmarket)</span>
        </div>
        <div class="nav-user">
            <button class="theme-toggle" onclick="toggleDarkMode()">
                <svg viewBox="0 0 24 24" class="sun-icon"><path d="M12 7c-2.76 0-5 2.24-5 5s2.24 5 5 5 5-2.24 5-5-2.24-5-5-5zM2 13h2c.55 0 1-.45 1-1s-.45-1-1-1H2c-.55 0-1 .45-1 1s.45 1 1 1zm18 0h2c.55 0 1-.45 1-1s-.45-1-1-1h-2c-.55 0-1 .45-1 1s.45 1 1 1zM11 2v2c0 .55.45 1 1 1s1-.45 1-1V2c0-.55-.45-1-1-1s-1 .45-1 1zm0 18v2c0 .55.45 1 1 1s1-.45 1-1v-2c0-.55-.45-1-1-1s-1 .45-1 1zM5.99 4.58c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0s.39-1.03 0-1.41L5.99 4.58zm12.37 12.37c-.39-.39-1.03-.39-1.41 0-.39.39-.39 1.03 0 1.41l1.06 1.06c.39.39 1.03.39 1.41 0 .39-.39.39-1.03 0-1.41l-1.06-1.06zm1.06-10.96c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06zM7.05 18.36c.39-.39.39-1.03 0-1.41-.39-.39-1.03-.39-1.41 0l-1.06 1.06c-.39.39-.39 1.03 0 1.41s1.03.39 1.41 0l1.06-1.06z"/></svg>
                <svg viewBox="0 0 24 24" class="moon-icon"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
            </button>
            <div class="nav-notifications">
                <button class="notification-bell" onclick="toggleNotifications()">
                    <svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.89 2 2 2zm6-6v-5c0-3.07-1.64-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.63 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2z"/></svg>
                    <span class="notification-badge">2</span>
                </button>
                <div class="notification-dropdown" id="notificationDropdown">
                    <div class="notification-header"><span class="notification-title">Notifications</span><span class="notification-clear" onclick="clearNotifications()">Mark all read</span></div>
                    <div class="notification-list">
                        <div class="notification-item unread"><div class="notification-icon alert"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg></div><div class="notification-content"><div class="notification-text"><strong>Safety Alert:</strong> AUC approaching floor at Site B</div><div class="notification-time">5 minutes ago</div></div></div>
                        <div class="notification-item unread"><div class="notification-icon warning"><svg viewBox="0 0 24 24"><path d="M1 21h22L12 2 1 21zm12-3h-2v-2h2v2zm0-4h-2v-4h2v4z"/></svg></div><div class="notification-content"><div class="notification-text"><strong>GPU Utilization:</strong> ER cluster at 94% capacity</div><div class="notification-time">1 hour ago</div></div></div>
                        <div class="notification-item"><div class="notification-icon success"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div><div class="notification-content"><div class="notification-text"><strong>Shadow Test:</strong> Candidate model ready for review</div><div class="notification-time">Yesterday</div></div></div>
                    </div>
                    <div class="notification-footer"><a href="#">View all notifications</a></div>
                </div>
            </div>
            <div class="nav-user-avatar">HM</div>
        </div>
    </nav>

    <main class="main">
        <header class="page-header">
            <h1 class="page-title">Hospital Management</h1>
            <p class="page-subtitle">Postmarket monitoring and operational oversight</p>
        </header>

        <!-- Alert Banner -->
        <div class="alert-banner" id="alertBanner">
            <div class="alert-icon"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg></div>
            <div class="alert-content">
                <div class="alert-title">Safety Floor Warning: Site B approaching threshold</div>
                <div class="alert-desc">Current AUC: 0.86 | FDA Safety Floor: 0.85 | Action required within 48 hours</div>
            </div>
            <button class="alert-action" onclick="openRevertModal()">Review & Act</button>
        </div>

        <div class="stats-row">
            <div class="stat-card"><div class="stat-value good">0.912</div><div class="stat-label">System AUC</div></div>
            <div class="stat-card"><div class="stat-value">12,847</div><div class="stat-label">Inferences Today</div></div>
            <div class="stat-card"><div class="stat-value warning">87%</div><div class="stat-label">GPU Utilization</div></div>
            <div class="stat-card"><div class="stat-value good">99.7%</div><div class="stat-label">Uptime (30d)</div></div>
        </div>

        <div class="tabs-container">
            <div class="tabs">
                <button class="tab active" data-tab="performance">Local Performance</button>
                <button class="tab" data-tab="infrastructure">Usage & Infrastructure</button>
                <button class="tab" data-tab="xai">Failure Cases & XAI</button>
                <button class="tab" data-tab="shadow">Shadow Mode</button>
                <button class="tab" data-tab="feedback">Feedback & Audit</button>
            </div>
        </div>

        <!-- Tab 1: Local Performance -->
        <div class="tab-content active" id="performance">
            <div class="content-grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div><h3 class="card-title">Distribution Drift & Local AUC Trends</h3><p class="card-subtitle">Performance against FDA Safety Floor</p></div>
                        <span class="card-badge live">Live Monitoring</span>
                    </div>
                    <div class="chart-container large"><canvas id="driftChart"></canvas></div>
                    <div class="safety-indicator">
                        <div class="safety-dot warning"></div>
                        <div class="safety-text">Site B is <span class="safety-value">1.2%</span> above FDA Safety Floor (0.85). Monitoring increased.</div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Site-by-Site Performance</h3><p class="card-subtitle">30-day rolling AUC</p></div></div>
                    <div class="chart-container"><canvas id="siteChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Drift Breakdown by Feature</h3><p class="card-subtitle">Contributing factors</p></div></div>
                    <div class="chart-container"><canvas id="featureDrift"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Tab 2: Usage & Infrastructure -->
        <div class="tab-content" id="infrastructure">
            <div class="content-grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div><h3 class="card-title">Edge-Node Allocator</h3><p class="card-subtitle">Drag nodes to reallocate processing power between departments</p></div>
                        <span class="card-badge">4 Active Nodes</span>
                    </div>
                    <div class="hardware-map">
                        <div class="hardware-node active" draggable="true">
                            <div class="node-icon"><svg viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg></div>
                            <div class="node-name">Node A</div>
                            <div class="node-dept">Emergency Room</div>
                            <div class="node-util">94% utilized</div>
                            <div class="node-util-bar"><div class="node-util-fill" style="width: 94%; background: var(--color-accent-orange);"></div></div>
                        </div>
                        <div class="hardware-node" draggable="true">
                            <div class="node-icon"><svg viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg></div>
                            <div class="node-name">Node B</div>
                            <div class="node-dept">Radiology</div>
                            <div class="node-util">67% utilized</div>
                            <div class="node-util-bar"><div class="node-util-fill" style="width: 67%; background: var(--color-accent-green);"></div></div>
                        </div>
                        <div class="hardware-node" draggable="true">
                            <div class="node-icon"><svg viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg></div>
                            <div class="node-name">Node C</div>
                            <div class="node-dept">ICU</div>
                            <div class="node-util">45% utilized</div>
                            <div class="node-util-bar"><div class="node-util-fill" style="width: 45%; background: var(--color-accent-green);"></div></div>
                        </div>
                        <div class="hardware-node" draggable="true">
                            <div class="node-icon"><svg viewBox="0 0 24 24"><path d="M20 18c1.1 0 1.99-.9 1.99-2L22 6c0-1.1-.9-2-2-2H4c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2H0v2h24v-2h-4zM4 6h16v10H4V6z"/></svg></div>
                            <div class="node-name">Node D</div>
                            <div class="node-dept">Outpatient</div>
                            <div class="node-util">23% utilized</div>
                            <div class="node-util-bar"><div class="node-util-fill" style="width: 23%; background: var(--color-accent-green);"></div></div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Inference Volume vs. GPU Load</h3><p class="card-subtitle">Last 24 hours</p></div></div>
                    <div class="chart-container"><canvas id="gpuChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Latency Distribution</h3><p class="card-subtitle">Response time by percentile</p></div></div>
                    <div class="chart-container"><canvas id="latencyChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Tab 3: Failure Cases & XAI -->
        <div class="tab-content" id="xai">
            <div class="content-grid">
                <div class="card">
                    <div class="card-header">
                        <div><h3 class="card-title">Low Confidence Outliers</h3><p class="card-subtitle">Cases requiring clinical review</p></div>
                        <span class="card-badge warning">6 Cases</span>
                    </div>
                    <div class="toggle-row">
                        <span class="toggle-label">Show Saliency Heatmaps</span>
                        <div class="toggle" id="xaiToggle" onclick="toggleXAI()"></div>
                    </div>
                    <div class="xai-gallery">
                        <div class="xai-case" style="--x: 65%; --y: 35%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4521</span><span class="xai-confidence">54%</span></div></div>
                        <div class="xai-case" style="--x: 40%; --y: 55%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4518</span><span class="xai-confidence">48%</span></div></div>
                        <div class="xai-case" style="--x: 70%; --y: 45%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4512</span><span class="xai-confidence">52%</span></div></div>
                        <div class="xai-case" style="--x: 55%; --y: 40%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4509</span><span class="xai-confidence">47%</span></div></div>
                        <div class="xai-case" style="--x: 45%; --y: 50%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4503</span><span class="xai-confidence">51%</span></div></div>
                        <div class="xai-case" style="--x: 60%; --y: 38%;"><div class="xai-scan"></div><div class="xai-heatmap"></div><div class="xai-label"><span>#4498</span><span class="xai-confidence">49%</span></div></div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Clinical Disagreement Rate</h3><p class="card-subtitle">AI vs. Radiologist findings</p></div></div>
                    <div class="chart-container"><canvas id="disagreementChart"></canvas></div>
                    <button class="btn btn-secondary" style="width: 100%; margin-top: 16px; justify-content: center;" onclick="openFeedbackModal()">
                        <svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>
                        Submit Correction
                    </button>
                </div>
            </div>
        </div>

        <!-- Tab 4: Shadow Mode -->
        <div class="tab-content" id="shadow">
            <div class="content-grid">
                <div class="card full-width">
                    <div class="card-header">
                        <div><h3 class="card-title">Shadow Mode Comparison</h3><p class="card-subtitle">Live model vs. candidate running on production data</p></div>
                        <span class="card-badge" style="background: rgba(124, 58, 237, 0.15); color: var(--color-accent-purple);">Shadow Active</span>
                    </div>
                    <div class="chart-container large"><canvas id="shadowChart"></canvas></div>
                    <div class="shadow-models">
                        <div class="shadow-model live">
                            <div class="shadow-header"><span class="shadow-name">v4.2.0 (Live)</span><span class="shadow-tag">Production</span></div>
                            <div class="shadow-stat"><span>AUC-ROC</span><span class="shadow-stat-value">0.912</span></div>
                            <div class="shadow-stat"><span>Sensitivity</span><span class="shadow-stat-value">0.887</span></div>
                            <div class="shadow-stat"><span>Specificity</span><span class="shadow-stat-value">0.924</span></div>
                            <div class="shadow-stat"><span>Avg Latency</span><span class="shadow-stat-value">178ms</span></div>
                        </div>
                        <div class="shadow-model candidate">
                            <div class="shadow-header"><span class="shadow-name">v4.3.0-rc1 (Shadow)</span><span class="shadow-tag">Candidate</span></div>
                            <div class="shadow-stat"><span>AUC-ROC</span><span class="shadow-stat-value better">0.934 ↑</span></div>
                            <div class="shadow-stat"><span>Sensitivity</span><span class="shadow-stat-value better">0.908 ↑</span></div>
                            <div class="shadow-stat"><span>Specificity</span><span class="shadow-stat-value">0.921</span></div>
                            <div class="shadow-stat"><span>Avg Latency</span><span class="shadow-stat-value better">156ms ↓</span></div>
                        </div>
                    </div>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Switch Impact Simulator</h3><p class="card-subtitle">Predicted outcomes if promoted today</p></div></div>
                    <div style="margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.06); font-size: 0.875rem;"><span>False Negatives Prevented</span><span style="color: var(--color-accent-green); font-weight: 600;">-18/month</span></div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; border-bottom: 1px solid rgba(0,0,0,0.06); font-size: 0.875rem;"><span>Latency Improvement</span><span style="color: var(--color-accent-green); font-weight: 600;">-12%</span></div>
                        <div style="display: flex; justify-content: space-between; padding: 10px 0; font-size: 0.875rem;"><span>Estimated ROI Impact</span><span style="color: var(--color-accent-green); font-weight: 600;">+$24,000/yr</span></div>
                    </div>
                    <button class="btn btn-primary btn-longpress" style="width: 100%; justify-content: center;" id="promoteBtn" onmousedown="startPromote()" onmouseup="cancelPromote()" onmouseleave="cancelPromote()">
                        <span class="progress"></span>
                        <svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg>
                        Hold 3s to Promote
                    </button>
                </div>
                <div class="card">
                    <div class="card-header"><div><h3 class="card-title">Validation Period</h3><p class="card-subtitle">Shadow test progress</p></div></div>
                    <div class="chart-container"><canvas id="validationChart"></canvas></div>
                </div>
            </div>
        </div>

        <!-- Tab 5: Feedback & Audit -->
        <div class="tab-content" id="feedback">
            <div class="content-grid">
                <div class="card">
                    <div class="card-header">
                        <div><h3 class="card-title">Clinician Flagging Portal</h3><p class="card-subtitle">Recent feedback from radiologists</p></div>
                        <span class="card-badge">8 This Week</span>
                    </div>
                    <div class="chart-container"><canvas id="feedbackChart"></canvas></div>
                </div>
                <div class="card">
                    <div class="card-header">
                        <div><h3 class="card-title">Regulatory Audit Trail</h3><p class="card-subtitle">21 CFR Part 11 compliant log</p></div>
                        <span class="card-badge">Compliant</span>
                    </div>
                    <div class="audit-trail">
                        <div class="audit-item">
                            <div class="audit-time">10:24 AM<br>Today</div>
                            <div class="audit-content"><span class="audit-user">Dr. Sarah Chen</span> <span class="audit-action">flagged case #4521 as false positive</span><span class="audit-badge signed">Signed</span></div>
                        </div>
                        <div class="audit-item">
                            <div class="audit-time">09:15 AM<br>Today</div>
                            <div class="audit-content"><span class="audit-user">System</span> <span class="audit-action">generated drift alert for Site B</span></div>
                        </div>
                        <div class="audit-item">
                            <div class="audit-time">04:30 PM<br>Yesterday</div>
                            <div class="audit-content"><span class="audit-user">Admin J. Park</span> <span class="audit-action">reallocated Node D to Outpatient</span><span class="audit-badge signed">Signed</span></div>
                        </div>
                        <div class="audit-item">
                            <div class="audit-time">02:12 PM<br>Yesterday</div>
                            <div class="audit-content"><span class="audit-user">Dr. Michael Ross</span> <span class="audit-action">approved shadow model for extended testing</span><span class="audit-badge signed">Signed</span></div>
                        </div>
                        <div class="audit-item">
                            <div class="audit-time">11:45 AM<br>Yesterday</div>
                            <div class="audit-content"><span class="audit-user">System</span> <span class="audit-action">completed daily SBOM security scan - no issues</span></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Revert to Manual Modal -->
    <div class="modal-overlay" id="revertModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon danger"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 15h-2v-2h2v2zm0-4h-2V7h2v6z"/></svg></div>
                <h2 class="modal-title">Critical Risk Response</h2>
                <p class="modal-subtitle">Site B performance requires immediate action</p>
            </div>
            <div class="modal-content">
                <div class="modal-warning">Reverting to manual review will require radiologist sign-off on all AI findings at Site B until performance stabilizes.</div>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeRevertModal()">Monitor Only</button>
                <button class="btn btn-danger" onclick="confirmRevert()">Revert to Manual</button>
            </div>
        </div>
    </div>

    <!-- Promote Model Modal -->
    <div class="modal-overlay" id="promoteModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon purple"><svg viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg></div>
                <h2 class="modal-title">Promote to Production</h2>
                <p class="modal-subtitle">21 CFR Part 11 signature required</p>
            </div>
            <div class="signature-section">
                <input type="text" class="signature-input" id="promoteSignature" placeholder="Type your full name" oninput="updatePromoteBtn()">
                <label class="checkbox-item">
                    <input type="checkbox" id="promoteAttest" onchange="updatePromoteBtn()">
                    <span class="checkbox-custom"></span>
                    <span class="checkbox-label">I authorize promotion of v4.3.0-rc1 to production</span>
                </label>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closePromoteModal()">Cancel</button>
                <button class="btn btn-primary" id="confirmPromoteBtn" disabled onclick="confirmPromote()">Confirm Deployment</button>
            </div>
        </div>
    </div>

    <!-- Success Modal -->
    <div class="modal-overlay" id="successModal">
        <div class="modal" style="text-align: center;">
            <div class="success-animation">
                <div class="success-circle"><svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg></div>
            </div>
            <h2 class="modal-title" style="color: var(--color-accent-green);">Action Completed</h2>
            <p class="modal-subtitle" id="successMessage">Your request has been processed.</p>
            <div class="modal-actions" style="justify-content: center; margin-top: 24px;">
                <button class="btn btn-primary" onclick="closeSuccessModal()">Done</button>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal-overlay" id="feedbackModal">
        <div class="modal">
            <div class="modal-header">
                <div class="modal-icon" style="background: linear-gradient(135deg, var(--color-accent-blue), var(--color-accent-teal));"><svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg></div>
                <h2 class="modal-title">Submit Clinical Correction</h2>
                <p class="modal-subtitle">Your feedback helps improve model accuracy</p>
            </div>
            <div class="modal-content">
                <select class="signature-input" style="font-family: var(--font-body); font-style: normal; font-size: 0.9375rem;">
                    <option>Select case ID...</option>
                    <option>#4521 - False Positive</option>
                    <option>#4518 - Missed Finding</option>
                    <option>#4512 - Incorrect Location</option>
                </select>
                <textarea class="signature-input" style="font-family: var(--font-body); font-style: normal; font-size: 0.9375rem; height: 100px; resize: none;" placeholder="Describe the correction..."></textarea>
            </div>
            <div class="modal-actions">
                <button class="btn btn-secondary" onclick="closeFeedbackModal()">Cancel</button>
                <button class="btn btn-primary" onclick="submitFeedback()">Submit Correction</button>
            </div>
        </div>
    </div>

    <script>
        // Tabs
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                tab.classList.add('active');
                document.getElementById(tab.dataset.tab).classList.add('active');
                initChartsForTab(tab.dataset.tab);
            });
        });

        // Notifications
        function toggleNotifications() { document.getElementById('notificationDropdown').classList.toggle('active'); }
        function clearNotifications() { document.querySelectorAll('.notification-item.unread').forEach(i => i.classList.remove('unread')); document.querySelector('.notification-badge').style.display = 'none'; }
        document.addEventListener('click', e => { if (!e.target.closest('.nav-notifications')) document.getElementById('notificationDropdown').classList.remove('active'); });

        // Dark mode
        function toggleDarkMode() { document.body.classList.toggle('dark-mode'); localStorage.setItem('darkMode', document.body.classList.contains('dark-mode')); }
        if (localStorage.getItem('darkMode') === 'true') document.body.classList.add('dark-mode');

        // XAI Toggle
        function toggleXAI() {
            const toggle = document.getElementById('xaiToggle');
            toggle.classList.toggle('active');
            document.querySelectorAll('.xai-case').forEach(c => c.classList.toggle('show-heatmap', toggle.classList.contains('active')));
        }

        // Modals
        function openRevertModal() { document.getElementById('revertModal').classList.add('active'); }
        function closeRevertModal() { document.getElementById('revertModal').classList.remove('active'); }
        function confirmRevert() { closeRevertModal(); showSuccess('Site B reverted to manual review mode'); }
        
        function openFeedbackModal() { document.getElementById('feedbackModal').classList.add('active'); }
        function closeFeedbackModal() { document.getElementById('feedbackModal').classList.remove('active'); }
        function submitFeedback() { closeFeedbackModal(); showSuccess('Correction submitted successfully'); }

        function closePromoteModal() { document.getElementById('promoteModal').classList.remove('active'); }
        function updatePromoteBtn() {
            const sig = document.getElementById('promoteSignature').value.trim().length >= 3;
            const att = document.getElementById('promoteAttest').checked;
            document.getElementById('confirmPromoteBtn').disabled = !(sig && att);
        }
        function confirmPromote() { closePromoteModal(); showSuccess('v4.3.0-rc1 promoted to production'); }

        function showSuccess(msg) {
            document.getElementById('successMessage').textContent = msg;
            document.getElementById('successModal').classList.add('active');
        }
        function closeSuccessModal() { document.getElementById('successModal').classList.remove('active'); }

        // Long press promote
        let promoteTimer;
        function startPromote() {
            document.getElementById('promoteBtn').classList.add('pressing');
            promoteTimer = setTimeout(() => {
                document.getElementById('promoteBtn').classList.remove('pressing');
                document.getElementById('promoteModal').classList.add('active');
            }, 3000);
        }
        function cancelPromote() {
            clearTimeout(promoteTimer);
            document.getElementById('promoteBtn').classList.remove('pressing');
        }

        // Charts
        let charts = {};
        function destroyChart(id) { if (charts[id]) { charts[id].destroy(); delete charts[id]; } }

        function initChartsForTab(tabId) {
            switch(tabId) {
                case 'performance': initDriftChart(); initSiteChart(); initFeatureDrift(); break;
                case 'infrastructure': initGpuChart(); initLatencyChart(); break;
                case 'xai': initDisagreementChart(); break;
                case 'shadow': initShadowChart(); initValidationChart(); break;
                case 'feedback': initFeedbackChart(); break;
            }
        }

        function initDriftChart() {
            destroyChart('driftChart');
            const ctx = document.getElementById('driftChart');
            if (!ctx) return;
            charts['driftChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['Week 1', 'Week 2', 'Week 3', 'Week 4', 'Week 5', 'Week 6', 'Week 7', 'Week 8'],
                    datasets: [
                        { label: 'Site A', data: [0.92, 0.91, 0.92, 0.91, 0.92, 0.91, 0.92, 0.91], borderColor: '#0066cc', tension: 0.4 },
                        { label: 'Site B', data: [0.91, 0.90, 0.89, 0.88, 0.87, 0.87, 0.86, 0.86], borderColor: '#f59e0b', tension: 0.4 },
                        { label: 'Site C', data: [0.93, 0.92, 0.93, 0.92, 0.92, 0.93, 0.92, 0.92], borderColor: '#10b981', tension: 0.4 },
                        { label: 'FDA Floor', data: [0.85, 0.85, 0.85, 0.85, 0.85, 0.85, 0.85, 0.85], borderColor: '#ef4444', borderDash: [5, 5], pointRadius: 0 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0.82, max: 0.95 } }, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function initSiteChart() {
            destroyChart('siteChart');
            const ctx = document.getElementById('siteChart');
            if (!ctx) return;
            charts['siteChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Site A', 'Site B', 'Site C', 'Site D'],
                    datasets: [{ data: [0.91, 0.86, 0.92, 0.90], backgroundColor: ['#10b981', '#f59e0b', '#10b981', '#10b981'], borderRadius: 8 }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0.80, max: 0.95 } }, plugins: { legend: { display: false } } }
            });
        }

        function initFeatureDrift() {
            destroyChart('featureDrift');
            const ctx = document.getElementById('featureDrift');
            if (!ctx) return;
            charts['featureDrift'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Patient Age', 'Image Noise', 'Slice Thickness', 'Scanner', 'Contrast'],
                    datasets: [{ data: [72, 58, 34, 28, 12], backgroundColor: '#0066cc', borderRadius: 6 }]
                },
                options: { responsive: true, maintainAspectRatio: false, indexAxis: 'y', scales: { x: { max: 100, title: { display: true, text: '% Contribution' } } }, plugins: { legend: { display: false } } }
            });
        }

        function initGpuChart() {
            destroyChart('gpuChart');
            const ctx = document.getElementById('gpuChart');
            if (!ctx) return;
            charts['gpuChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: ['12am', '3am', '6am', '9am', '12pm', '3pm', '6pm', '9pm'],
                    datasets: [
                        { label: 'Inferences', data: [120, 45, 89, 567, 823, 756, 634, 412], borderColor: '#0066cc', yAxisID: 'y', tension: 0.4 },
                        { label: 'GPU %', data: [23, 12, 18, 78, 94, 87, 76, 54], borderColor: '#f59e0b', yAxisID: 'y1', tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { position: 'left' }, y1: { position: 'right', max: 100 } }, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function initLatencyChart() {
            destroyChart('latencyChart');
            const ctx = document.getElementById('latencyChart');
            if (!ctx) return;
            charts['latencyChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['p50', 'p75', 'p90', 'p95', 'p99'],
                    datasets: [{ data: [145, 178, 234, 312, 456], backgroundColor: ['#10b981', '#10b981', '#0066cc', '#f59e0b', '#ef4444'], borderRadius: 6 }]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { title: { display: true, text: 'Latency (ms)' } } }, plugins: { legend: { display: false } } }
            });
        }

        function initDisagreementChart() {
            destroyChart('disagreementChart');
            const ctx = document.getElementById('disagreementChart');
            if (!ctx) return;
            charts['disagreementChart'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Agreement', 'AI Overcall', 'AI Undercall'],
                    datasets: [{ data: [94, 4, 2], backgroundColor: ['#10b981', '#f59e0b', '#ef4444'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function initShadowChart() {
            destroyChart('shadowChart');
            const ctx = document.getElementById('shadowChart');
            if (!ctx) return;
            charts['shadowChart'] = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: Array.from({length: 14}, (_, i) => `Day ${i + 1}`),
                    datasets: [
                        { label: 'Live (v4.2.0)', data: [0.910, 0.912, 0.909, 0.914, 0.911, 0.913, 0.910, 0.912, 0.914, 0.911, 0.913, 0.912, 0.910, 0.912], borderColor: '#10b981', tension: 0.4 },
                        { label: 'Shadow (v4.3.0-rc1)', data: [0.928, 0.932, 0.930, 0.935, 0.933, 0.936, 0.932, 0.934, 0.937, 0.933, 0.935, 0.934, 0.932, 0.934], borderColor: '#7c3aed', borderDash: [5, 5], tension: 0.4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { y: { min: 0.90, max: 0.95 } }, plugins: { legend: { position: 'bottom' } } }
            });
        }

        function initValidationChart() {
            destroyChart('validationChart');
            const ctx = document.getElementById('validationChart');
            if (!ctx) return;
            charts['validationChart'] = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: ['Completed', 'Remaining'],
                    datasets: [{ data: [14, 7], backgroundColor: ['#7c3aed', 'rgba(0,0,0,0.1)'], borderWidth: 0 }]
                },
                options: { responsive: true, maintainAspectRatio: false, cutout: '70%', plugins: { legend: { display: false } } }
            });
        }

        function initFeedbackChart() {
            destroyChart('feedbackChart');
            const ctx = document.getElementById('feedbackChart');
            if (!ctx) return;
            charts['feedbackChart'] = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                    datasets: [
                        { label: 'False Positive', data: [2, 1, 3, 1, 2, 0, 1], backgroundColor: '#f59e0b', borderRadius: 4 },
                        { label: 'False Negative', data: [1, 0, 1, 2, 0, 0, 0], backgroundColor: '#ef4444', borderRadius: 4 }
                    ]
                },
                options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true }, y: { stacked: true } }, plugins: { legend: { position: 'bottom' } } }
            });
        }

        // Init
        document.addEventListener('DOMContentLoaded', () => { initDriftChart(); initSiteChart(); initFeatureDrift(); });
    </script>
</body>
</html>

